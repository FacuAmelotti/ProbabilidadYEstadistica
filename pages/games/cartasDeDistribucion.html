<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juego de Distribuciones - PyE</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;600&display=swap"
    rel="stylesheet"
  />
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Work Sans', sans-serif;
      background: radial-gradient(circle at top, #0e0e1a, #000);
      color: white;
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    nav.navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 30px;
      z-index: 10;
    }

    nav .logo {
      display: flex;
      align-items: center;
      color: white;
      text-decoration: none;
      font-weight: 600;
      gap: 10px;
    }

    .nav-menu {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
    }

    .nav-link {
      color: white;
      text-decoration: none;
      font-weight: 400;
      transition: color 0.3s;
      cursor: pointer;
    }

    .nav-link:hover {
      color: #a8b5ff;
    }

    .main-container {
      display: flex;
      flex: 1;
      height: 100%;
      width: 100%;
      align-items: center;
      justify-content: center;
      padding: 40px 20px 10px;
      gap: 30px;
    }

    /* Barra de progreso lateral */
    .progress-sidebar {
      width: 60px;
      height: 400px;
      background: rgba(255,255,255,0.05);
      border-radius: 30px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 10px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .progress-segment {
      width: 100%;
      height: 25px;
      border-radius: 5px;
      margin: 2px 0;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .progress-segment.pending {
      background: rgba(255,255,255,0.1);
    }

    .progress-segment.correct {
      background: rgba(120,255,120,0.6);
    }

    .progress-segment.incorrect {
      background: rgba(255,120,120,0.6);
    }

    .progress-segment.current {
      background: rgba(255,215,0,0.8);
      box-shadow: 0 0 15px rgba(255,215,0,0.5);
    }

    /* √Årea principal de la pregunta */
    .question-area {
      flex: 1;
      max-width: 700px;
      padding: 40px;
      border-radius: 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 40px rgba(120,119,198,0.2);
      animation: fadeInUp 0.6s ease;
    }

    h1 {
      text-align: center;
      font-size: 2.3rem;
      font-weight: 300;
      background: linear-gradient(135deg, #fff, #a8b5ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 30px;
    }

    .question-card {
      text-align: left;
      margin-bottom: 30px;
    }

    .question-title {
      font-size: 1.6rem;
      margin-bottom: 10px;
      color: #fff;
    }

    .question-desc {
      color: rgba(255,255,255,0.8);
      margin-bottom: 20px;
      line-height: 1.5;
      font-style: italic;
    }

    .question-number {
      color: #a8b5ff;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    /* HUD de progreso */
    .hud-container {
      position: fixed;
      top: 80px;
      right: 30px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }

    .hud-item {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hud-label {
      color: rgba(255,255,255,0.7);
      font-size: 0.9rem;
    }

    .hud-value {
      color: #fff;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .score-value {
      color: #4CAF50;
    }

    /* √Årea de cartas */
    .cards-container {
      width: 100%;
      max-width: 1500px;
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin: 0 auto;
    }

    .distribution-card {
      width: 185px;
      height: 160px;
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
    }

    .distribution-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 15px;
    }

    .distribution-card:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,255,255,0.2);
    }

    .distribution-card.correct {
      background: rgba(120,255,120,0.2);
      border-color: rgba(120,255,120,0.8);
      animation: correctPulse 0.6s ease;
    }

    .distribution-card.incorrect {
      background: rgba(255,120,120,0.2);
      border-color: rgba(255,120,120,0.8);
      animation: incorrectShake 0.6s ease;
    }

    .distribution-card.disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Feedback */
    .feedback-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .feedback-content {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .feedback-title {
      font-size: 2rem;
      margin-bottom: 20px;
    }

    .feedback-title.correct {
      color: #4CAF50;
    }

    .feedback-title.incorrect {
      color: #f44336;
    }

    .feedback-explanation {
      color: rgba(255,255,255,0.9);
      line-height: 1.6;
      margin-bottom: 30px;
      text-align: left;
    }

    .feedback-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(135deg, #7877c6, #6564b5);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(120,119,198,0.4);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Resultados finales */
    .final-results {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .results-title {
      font-size: 2.5rem;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #fff, #a8b5ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 600;
      color: #4CAF50;
    }

    .stat-label {
      color: rgba(255,255,255,0.7);
      margin-top: 5px;
    }

    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
        padding: 100px 10px 10px;
      }

      .progress-sidebar {
        width: 100%;
        height: 40px;
        flex-direction: row;
        order: 2;
      }

      .hud-container {
        position: static;
        margin-bottom: 20px;
        width: 100%;
      }

      .cards-container {
        gap: 10px;
        padding: 10px;
      }

      .distribution-card {
        width: 120px;
        height: 180px;
      }

      .distribution-card img {
        width: 100%;
        height: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="logo">
      PyE - Juego de Distribuciones
    </div>
    <ul class="nav-menu">
      <li><a id="back-btn" class="nav-link">Volver</a></li>
    </ul>
  </nav>

  <!-- HUD -->
  <div class="hud-container">
    <div class="hud-item">
      <span class="hud-label">Pregunta:</span>
      <span class="hud-value" id="currentQuestion">1 / 10</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Correctas:</span>
      <span class="hud-value score-value" id="correctAnswers">0</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Puntuaci√≥n:</span>
      <span class="hud-value score-value" id="score">0</span>
    </div>
  </div>

  <div class="main-container">
    <!-- Barra de progreso lateral -->
    <div class="progress-sidebar" id="progressBar">
      <!-- Se generar√°n din√°micamente -->
    </div>

    <!-- √Årea principal de pregunta -->
    <div class="question-area">
      <h1>Distribuciones Estad√≠sticas</h1>
      <div class="question-card">
        <div class="question-number" id="questionNumber">Pregunta 1 de 10</div>
        <h2 class="question-title" id="questionTitle"></h2>
        <p class="question-desc" id="questionDesc"></p>
      </div>
    </div>
  </div>

  <!-- √Årea de cartas -->
  <div class="cards-container" id="cardsContainer">
    <!-- Se generar√°n din√°micamente -->
  </div>

  <!-- Feedback Overlay -->
  <div class="feedback-overlay" id="feedbackOverlay">
    <div class="feedback-content" id="feedbackContent">
      <div class="feedback-title" id="feedbackTitle"></div>
      <div class="feedback-explanation" id="feedbackExplanation"></div>
      <div class="feedback-buttons">
        <button class="btn btn-primary" id="nextBtn">Siguiente Pregunta</button>
        <button class="btn btn-secondary" id="retryBtn" style="display: none;">Reintentar</button>
      </div>
    </div>
  </div>

  <!-- Resultados finales -->
  <div class="final-results" id="finalResults">
    <div class="results-title">¬°Juego Completado!</div>
    <div class="results-stats">
      <div class="stat-card">
        <div class="stat-value" id="finalScore">0</div>
        <div class="stat-label">Puntuaci√≥n Final</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="accuracy">0%</div>
        <div class="stat-label">Precisi√≥n</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="correctCount">0 / 10</div>
        <div class="stat-label">Respuestas Correctas</div>
      </div>
    </div>
    <div class="feedback-buttons">
      <button class="btn btn-primary" id="restartBtn">Jugar de Nuevo</button>
      <button class="btn btn-secondary" id="backToMenuBtn">Men√∫ Principal</button>
    </div>
  </div>

<script>
  let gameData = null;
  let currentQuestionIndex = 0;
  let score = 0;
  let correctAnswers = 0;
  let questionsAnswered = [];
  let isAnswered = false;

  // Mapeo de distribuciones a nombres de archivos de imagen
  const distributionImages = {
    "Bernoulli": "../../src/img/juegoDistribuciones/bernoulli.jpg",
    "Binomial": "../../src/img/juegoDistribuciones/binomial.jpg", 
    "Geom√©trica": "../../src/img/juegoDistribuciones/geometrica.jpg",
    "Poisson": "../../src/img/juegoDistribuciones/poisson.jpg",
    "Hipergeom√©trica": "../../src/img/juegoDistribuciones/hypergeometrica.jpg",
    "Uniforme": "../../src/img/juegoDistribuciones/uniforme.jpg",
    "Exponencial": "../../src/img/juegoDistribuciones/exponencial.jpg",
    "Normal": "../../src/img/juegoDistribuciones/normal.jpg",
    "Chi-Cuadrado": "../../src/img/juegoDistribuciones/chicuadrado.jpg",
    "t de Student": "../../src/img/juegoDistribuciones/tstudent.jpg",
    "F de Fisher": "../../src/img/juegoDistribuciones/fisher.jpg"
  };

  // Lista completa de distribuciones
  const allDistributions = [
    "Bernoulli",
    "Binomial", 
    "Geom√©trica",
    "Poisson",
    "Hipergeom√©trica",
    "Uniforme",
    "Exponencial",
    "Normal",
    "Chi-Cuadrado",
    "t de Student",
    "F de Fisher"
  ];

  // ==============================
  // üöÄ Inicializaci√≥n del juego
  // ==============================
  async function initGame() {
    try {
      const response = await fetch('../../src/json/juego_distribuciones.json');
      gameData = await response.json();
      
      // Mezclar preguntas
      gameData = shuffleArray([...gameData]).slice(0, 10);

      
      // Crear barra de progreso
      createProgressBar();
      
      // Cargar primera pregunta
      loadQuestion();
      
      // Configurar event listeners
      document.getElementById('nextBtn').addEventListener('click', nextQuestion);
      document.getElementById('retryBtn').addEventListener('click', nextQuestion);
      document.getElementById('restartBtn').addEventListener('click', restartGame);
      document.getElementById('backToMenuBtn').addEventListener('click', () => window.location.href = '../../index.htmll');
      
    } catch (error) {
      console.error('Error cargando el juego:', error);
      alert('Error cargando el juego. Por favor, recarga la p√°gina.');
    }
  }

  // ==============================
  // üìä Crear barra de progreso
  // ==============================
  function createProgressBar() {
    const progressBar = document.getElementById('progressBar');
    progressBar.innerHTML = '';
    
    for (let i = 0; i < 10; i++) {
      const segment = document.createElement('div');
      segment.className = 'progress-segment pending';
      segment.id = `progress-${i}`;
      segment.addEventListener('click', () => goToQuestion(i));
      progressBar.appendChild(segment);
    }
  }

  // ==============================
  // ‚ùì Cargar pregunta actual
  // ==============================
  function loadQuestion() {
    if (currentQuestionIndex >= gameData.length) {
      showFinalResults();
      return;
    }

    const question = gameData[currentQuestionIndex];
    isAnswered = false;

    // Actualizar UI
    document.getElementById('currentQuestion').textContent = `${currentQuestionIndex + 1} / 10`;

    document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1} de 10`;

    document.getElementById('questionTitle').textContent = question.pregunta;
    document.getElementById('questionDesc').textContent = question.descripcion;

    // Crear cartas de distribuciones
    createDistributionCards();

    // Actualizar barra de progreso
    updateProgressBar();
  }

  // ==============================
  // üÉè Crear cartas de distribuciones
  // ==============================
  function createDistributionCards() {
    const container = document.getElementById('cardsContainer');
    container.innerHTML = '';

    const question = gameData[currentQuestionIndex];
    const correctAnswer = question.respuestaCorrecta;

    // Crear lista de distribuciones para mostrar (correcta + 5-7 distractores aleatorios)
    const availableDistributions = allDistributions.filter(d => d !== correctAnswer);
    
    // Seleccionar 5-7 distractores aleatorios
    const numDistractors = Math.floor(Math.random() * 3) + 4; // 5, 6, o 7
    const shuffledDistractors = shuffleArray(availableDistributions).slice(0, numDistractors);
    
    // Crear lista final: correcta + distractores
    const finalDistributions = shuffleArray([correctAnswer, ...shuffledDistractors]);

    // Crear cartas con im√°genes
    finalDistributions.forEach(dist => {
      const card = document.createElement('div');
      card.className = 'distribution-card';
      
      // Crear elemento img para la carta
      const img = document.createElement('img');
      img.src = distributionImages[dist];
      img.alt = dist;
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.objectFit = 'cover';
      img.style.borderRadius = '12px';
      
      // A√±adir imagen a la carta
      card.appendChild(img);
      
      // Agregar evento de click
      card.onclick = () => selectDistribution(dist, card);
      
      container.appendChild(card);
    });
  }

  // ==============================
  // ‚úÖ Seleccionar distribuci√≥n
  // ==============================
  function selectDistribution(selectedDist, cardElement) {
    if (isAnswered) return;

    isAnswered = true;
    const question = gameData[currentQuestionIndex];
    const isCorrect = selectedDist === question.respuestaCorrecta;

    // Deshabilitar todas las cartas y agregar efectos de respuesta
    const allCards = document.querySelectorAll('.distribution-card');
    allCards.forEach(card => {
      card.classList.add('disabled');
      
      // Verificar si la carta contiene la respuesta correcta
      const img = card.querySelector('img');
      if (img && img.alt === question.respuestaCorrecta) {
        card.classList.add('correct');
      }
      
      // Verificar si esta es la carta seleccionada incorrecta
      if (card === cardElement && !isCorrect) {
        card.classList.add('incorrect');
      }
    });

    // Actualizar puntuaci√≥n
    if (isCorrect) {
      score += 100;
      correctAnswers++;
      showFeedback(true, question);
    } else {
      showFeedback(false, question);
    }

    // Registrar respuesta
    questionsAnswered[currentQuestionIndex] = {
      question: question,
      selected: selectedDist,
      correct: isCorrect,
      score: isCorrect ? 100 : 0
    };

    updateHUD();
  }

  // ==============================
  // üí¨ Mostrar feedback
  // ==============================
  function showFeedback(isCorrect, question) {
    const overlay = document.getElementById('feedbackOverlay');
    const title = document.getElementById('feedbackTitle');
    const explanation = document.getElementById('feedbackExplanation');
    const nextBtn = document.getElementById('nextBtn');
    const retryBtn = document.getElementById('retryBtn');

    title.textContent = isCorrect ? '‚úÖ ¬°Correcto!' : '‚ùå Incorrecto';
    title.className = `feedback-title ${isCorrect ? 'correct' : 'incorrect'}`;
    explanation.textContent = question.explicacion;

    if (isCorrect) {
      nextBtn.style.display = 'inline-block';
      retryBtn.style.display = 'none';
    } else {
      nextBtn.style.display = 'inline-block';
      retryBtn.style.display = 'none';
    }

    overlay.style.display = 'flex';
  }

  // ==============================
  // ‚û°Ô∏è Siguiente pregunta
  // ==============================
  function nextQuestion() {
    document.getElementById('feedbackOverlay').style.display = 'none';
    currentQuestionIndex++;
    loadQuestion();
  }

  // ==============================
  // üéØ Ir a pregunta espec√≠fica
  // ==============================
  function goToQuestion(index) {
    if (index <= currentQuestionIndex && questionsAnswered[index] !== undefined) {
      currentQuestionIndex = index;
      loadQuestion();
    }
  }

  // ==============================
  // üìä Actualizar barra de progreso
  // ==============================
  function updateProgressBar() {
    for (let i = 0; i < 10; i++) {
      const segment = document.getElementById(`progress-${i}`);
      segment.className = 'progress-segment';
      
      if (i < currentQuestionIndex) {
        if (questionsAnswered[i]?.correct) {
          segment.classList.add('correct');
        } else {
          segment.classList.add('incorrect');
        }
      } else if (i === currentQuestionIndex) {
        segment.classList.add('current');
      } else {
        segment.classList.add('pending');
      }
    }
  }

  // ==============================
  // üìà Actualizar HUD
  // ==============================
  function updateHUD() {
    document.getElementById('correctAnswers').textContent = correctAnswers;
    document.getElementById('score').textContent = score;
  }

  // ==============================
  // üèÜ Mostrar resultados finales
  // ==============================
  function showFinalResults() {
    const accuracy = Math.round((correctAnswers / 10) * 100);
    
    document.getElementById('finalScore').textContent = score;
    document.getElementById('accuracy').textContent = `${accuracy}%`;
    document.getElementById('correctCount').textContent = `${correctAnswers} / 10`;
    
    // Ocultar elementos del juego
    document.querySelector('.main-container').style.display = 'none';
    document.getElementById('cardsContainer').style.display = 'none';
    document.querySelector('.hud-container').style.display = 'none';
    
    // Mostrar resultados
    document.getElementById('finalResults').style.display = 'block';
    
    // Guardar puntuaci√≥n en localStorage
    const bestScore = localStorage.getItem('pye-best-score');
    if (!bestScore || score > parseInt(bestScore)) {
      localStorage.setItem('pye-best-score', score.toString());
    }
  }

  // ==============================
  // üîÑ Reiniciar juego
  // ==============================
  function restartGame() {
    currentQuestionIndex = 0;
    score = 0;
    correctAnswers = 0;
    questionsAnswered = [];
    
    // Mostrar elementos del juego
    document.querySelector('.main-container').style.display = 'flex';
    document.getElementById('cardsContainer').style.display = 'flex';
    document.querySelector('.hud-container').style.display = 'block';
    
    // Ocultar resultados
    document.getElementById('finalResults').style.display = 'none';
    
    // Recargar datos del juego
    initGame();
  }

  // ==============================
  // üîÄ Utilidad: mezclar array
  // ==============================
  function shuffleArray(arr) {
    return arr.sort(() => Math.random() - 0.5);
  }

  // ==============================
  // üöÄ Inicializar cuando cargue la p√°gina
  // ==============================
  document.addEventListener('DOMContentLoaded', initGame);

              // Bot√≥n "Volver" din√°mico
    document.getElementById('back-btn').addEventListener('click', () => {
      if (document.referrer && document.referrer !== window.location.href) {
        history.back();
      } else {
        window.location.href = '../../temario.html'; // fallback si se abre directo
      }
    });
</script>
</body>
</html>